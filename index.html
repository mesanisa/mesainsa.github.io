<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8" />
<title>تخفیفات فروشگاه شهروند صادقیه</title>
<style>
  body {
    font-family: Tahoma, sans-serif;
    background: #f7faff;
    padding: 2rem;
    color: #333;
  }
  h1 {
    text-align: center;
    color: #0077cc;
    margin-bottom: 2rem;
  }
  .product-container {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 1.5rem;
  }
  .product-card {
    background: white;
    border-radius: 1rem;
    padding: 1rem 1.5rem;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
    max-width: 220px;
    text-align: center;
    transition: box-shadow 0.3s ease;
  }
  .product-card:hover {
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
  }
  .product-card img {
    width: 150px;
    border-radius: 0.75rem;
    margin-bottom: 1rem;
  }
  .product-title {
    font-weight: bold;
    font-size: 1.1rem;
    color: #004080;
    margin-bottom: 0.5rem;
  }
  .discount-percent {
    background: #d4f4e4;
    color: #207f4e;
    padding: 0.3rem 0.8rem;
    border-radius: 1rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
    display: inline-block;
  }
  .original-price {
    text-decoration: line-through;
    color: #7a7a7a;
    margin-bottom: 0.3rem;
  }
  .discounted-price {
    color: #d42c21;
    font-weight: 700;
    margin-bottom: 0.8rem;
  }
  .discount-date span {
    display: block;
    font-size: 0.9rem;
    color: #555;
    margin-top: 0.3rem;
  }
</style>
</head>
<body>

<h1>تخفیفات داغ و جذاب فروشگاه شهروند صادقیه</h1>

<div id="product-list" class="product-container">در حال بارگذاری...</div>

<script>
  const url = 'https://script.google.com/macros/s/AKfycbzCLDoFbbuaZPEbRsdK_6XnC2w0diHZgIB9gJ6Dh4ssUUmYhUKmjJwgviDE0ADyZiZI/exec';

  fetch(url)
    .then(response => {
      if (!response.ok) throw new Error('خطا در دریافت اطلاعات: ' + response.status);
      return response.json();
    })
    .then(data => {
      const container = document.getElementById('product-list');
      container.innerHTML = '';

      data.forEach(item => {
        let discount = item.discount;
        if (typeof discount === 'number' && discount <= 1) {
          discount = (discount * 100).toFixed(0) + '%';
        } else if (typeof discount === 'string') {
          discount = discount.trim();
        }

        let imgUrl = item.imgUrl || '';
        if(imgUrl.startsWith('https://imgur.com') && !imgUrl.match(/\.(jpg|jpeg|png)$/)){
          imgUrl = imgUrl + '.jpg';
        }

        // فرمت جداکننده هزارگان برای قیمت‌ها
        const formattedOriginalPrice = Number(item.originalPrice.toString().replace(/,/g, '')).toLocaleString('fa-IR');
        const formattedDiscountedPrice = Number(item.discountedPrice.toString().replace(/,/g, '')).toLocaleString('fa-IR');

        container.innerHTML += `
          <div class="product-card">
            <img src="${imgUrl}" alt="${item.title}" />
            <div class="product-title">${item.title}</div>
            <div class="discount-percent">${discount} تخفیف</div>
            <div class="original-price">${formattedOriginalPrice} تومان</div>
            <div class="discounted-price">${formattedDiscountedPrice} تومان</div>
            <div class="discount-date">
              <span>تاریخ شروع: ${item.startDate}</span>
              <span>تاریخ پایان: ${item.endDate}</span>
            </div>
          </div>
        `;
      });

      if (data.length === 0) {
        container.innerHTML = '<p>هیچ محصولی برای نمایش وجود ندارد.</p>';
      }
    })
    .catch(error => {
      console.error(error);
      document.getElementById('product-list').innerHTML = '<p>خطا در بارگذاری اطلاعات محصولات.</p>';
    });
</script>

</body>
</html>
